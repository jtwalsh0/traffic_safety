
import_shapefile()
    BASENAME=$(echo $INPUT | sed 's/.shp//')
    # get table name from output, e.g. change $BASE/psql/input/wards gives input.wards
    TABLENAME=$(echo $OUTPUT | sed 's/.*psql\///;s/\//./')
    # ogr2ogr doesn't like an existing file
    rm -f "$BASENAME"4326.*
    ogr2ogr -t_srs EPSG:4326 "$BASENAME"4326.shp $INPUT
    # -q suppresses query output which for large shapefiles seems to slow down the import
    shp2pgsql -I -D -d -s 4326 "$BASENAME"4326.shp $TABLENAME | psql -q
    touch $OUTPUT

wget_unzip()
    mkdir -p $(dirname $OUTPUT0)
    wget --output-document="$OUTPUT0" "$URL"
    unzip -o "$OUTPUT0" -d $(dirname $OUTPUT1)


; The University of Alabama's Center for Advanced Public Safety makes Alabama traffic-safety data
; available to the public, but you have to download their CARE software to do it. I downloaded 
; CARE (http://www.caps.ua.edu/analytics/downloads/care-software/) and exported the data in 
; CSV format to an S3 bucket.  

input/data/CARE_data.csv <- s3://transportation-safety-data/CareExport1.csv
	s3cmd get $INPUT - | awk '(NR>4)' | sed 's/"Null value"//g' > $OUTPUT

input/psql/care <- input/care.sql, input/data/CARE_data.csv [method:psql]